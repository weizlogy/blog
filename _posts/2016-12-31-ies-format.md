---
layout: post
title:  "iesファイルフォーマット解説"
date:   2016-12-31 17:29:00.001 09:00
categories: tos-addon-dev
---

???は可変長です。

## Total block

```
 ------------------- ---------------------------- -------------------------
| Header [156 byte] | Cell Header [136 x N byte] | Row Data [??? x M byte] |
 ------------------- ---------------------------- -------------------------
```

N=列数。は、Header blockのCellCountで指定。 M=行数。は、Header blockのRowCountで指定。 

## Header block

```
 ---------------------- ------------------- ------------------------
| TableName [128 byte] | Reserve1 [4 byte] | OffsetOfData [4 byte]  |
 ---------------------- ------------------- ------------------------
 --------------------------- ------------------- -------------------
| OffsetOfResource [4 byte] | FileSize [4 byte] | Reserve2 [4 byte] |
 --------------------------- ------------------- -------------------
 ------------------- -------------------- --------------------------
| RowCount [2 byte] | CellCount [2 byte] | NumCellCount [2 byte]    |
 ------------------- -------------------- --------------------------
 ----------------------- -------------------------------------------
| StrCellCount [2 byte] | Reserve3 [2 byte] | --------------------- |
 ----------------------- -------------------------------------------
```

| | |
|:---|:---|
| TableName | IESテーブル名 |
| Reserve1 | 予約1 |
| OffsetOfData | Cell Header blockのサイズ |
| OffsetOfResource | Row Data blockのサイズ |
| FileSize | IESファイルサイズ |
| Reserve2 | 予約2 |
| RowCount | 行数 |
| CellCount | 列数 |
| NumCellCount | 数値列数 |
| StrCellCount | 文字列列数 |
| Reserve3 | 予約3 |

## Cell Header block

```
 ---------------- ------------------- ----------------------
| Name [64 byte] | Name2 [64 byte] | Type [2 byte] | ------ |
 ---------------- ------------------- ----------------------
 ------------------- ------------------- -------------------
| Reserve1 [2 byte] | Reserve2 [4 byte] | Position [2 byte] |
 ------------------- ------------------- -------------------
```

| | |
|:---|:---|
| Name | Cell名 |
| Name2 | Cell別名 |
| Type | 0：数値Cell、1,2：文字列Cell |
| Reserve1 | 予約1 |
| Reserve2 | 予約2 |
| Position | Type内Cell順序 |

Cell順は、Type昇順、Position昇順。 

## Row Data block

```
 ------------------- ---------------------- --------------------
| Option [??? byte] | Cell Data [??? byte] | Padding [??? byte] |
 ------------------- ---------------------- --------------------
```

Paddingは、文字列Cellの数だけ0x00が付与される。 

### Option block

```
 ------------------- --------------- -----------------
| Reserve1 [4 byte] | Size [2 byte] | Name [??? byte] |
 ------------------- --------------- -----------------
```

| | |
|:---|:---|
| Reserve1 | 予約1 |
| Size | Nameのバイト長 |
| Name | Cellオプション名 |

### Cell Data block

数値Cellの場合： 

```
 ----------------
| Value [4 byte] |
 ----------------
```

文字列Cellの場合： 

```
 --------------- ------------------
| Size [2 byte] | Value [??? byte] |
 --------------- ------------------
```

| | |
|:---|:---|
| Size | Nameのバイト長 |
| Name | 列データ |
